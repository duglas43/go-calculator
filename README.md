# Go вычислятор
Это простой калькулятор, написанный на языке Go. Он поддерживает базовые арифметические операции: сложение, вычитание, умножение и деление.

Курс: Промышленная разработка на C&GO.

Выполнил: Малков Евгений, группа: K4110c

## Быстрый старт
1. Установите Docker и Docker Compose.
2. Склонируйте репозиторий:
```bash
  git clone https://github.com/duglas43/go-calculator.git
  cd go-calculator
```
3. Запустите приложение с помощью Docker Compose:
```bash
  docker-compose up -d
```
4. Откройте браузер и перейдите по адресу: [http://localhost:3000/swagger/index.html](http://localhost:3000/swagger/index.html)

## Цель работы
Разработать сервер на Go, способный обрабатывать инструккии двух типов: calc - вычисление и print - вывод значения переменной. Требовалась реализация минимального API и поддержка выполнения операций с имитацией тяжёлых вычислений.

## Что реализовано
1) Реализован тип Executor, хранящий переменные и поддерживающий многопоточную безопасность через RWMutex.
2) HTTP API на базе Gin.
3) Описан один HTTP endpoint /execute для обработки всех инструкций.
4) Swagger-документация (/swagger/index.html).
5) Реализован базовый unit-test для Executor
6) Развёртка через Docker Compose.

## Что не реализовано
1) GRPC реализация. 
2) Поддержка параллельного выполнения команд. В текущей реализации команды выполняются последовательно.

## Общее устройство проекта

1) internal/executor/executor.go: основная бизнес-логика обработки инструкций
2) internal/handler/handler.go: HTTP-обработчик и парсинг входных данных
3) cmd/main.go: инициализация HTTP-сервера
4) test/executor_test.go: unit-тест для Executor

## Логика работы

Вся бизнес-логика реализована в executor.go. Переменные хранятся в map[string]int, доступ к которой защищён с помощью sync.RWMutex, чтобы избежать гонок при чтении и записи. Это позволяет безопасно обращаться к данным из нескольких горутин, хотя в текущем варианте команды выполняются последовательно. В будущем можно будет добавить поддержку параллельного выполнения команд.

Команда calc может принимать одно или два значения и выполнять одну из операций: +, -, *. Если переменная не найдена — возвращается ошибка. Для имитации долгих вычислений искусственно добавлена задержка 50ms.
Команда print просто возвращает значение переменной, если оно есть.

## Пример работы

Запрос: POST /execute
```json
{
  "instructions": [
    {
      "type": "calc",
      "op": "+",
      "var": "x",
      "left": 10,
      "right": 2
    },
    {
      "type": "calc",
      "op": "*",
      "var": "y",
      "left": "x",
      "right": 5
    },
    {
      "type": "calc",
      "op": "-",
      "var": "q",
      "left": "y",
      "right": 20
    },
    {
      "type": "calc",
      "op": "+",
      "var": "unusedA",
      "left": "y",
      "right": 100
    },
    {
      "type": "calc",
      "op": "*",
      "var": "unusedB",
      "left": "unusedA",
      "right": 2
    },
    {
      "type": "print",
      "var": "q"
    },
    {
      "type": "calc",
      "op": "-",
      "var": "z",
      "left": "x",
      "right": 15
    },
    {
      "type": "print",
      "var": "z"
    },
    {
      "type": "calc",
      "op": "+",
      "var": "ignoreC",
      "left": "z",
      "right": "y"
    },
    {
      "type": "print",
      "var": "x"
    }
  ]
}
```

Ответ:
```json
[
  {
    "var": "q",
    "value": 40
  },
  {
    "var": "z",
    "value": -3
  },
  {
    "var": "x",
    "value": 12
  }
]
```

Тесты:
![alt text](/attachments/image.png)

## Вывод

В ходе выполнения работы был разработан простой HTTP-сервер на Go, способный обрабатывать базовые арифметические операции и выводить значения переменных.